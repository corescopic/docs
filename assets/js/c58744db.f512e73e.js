"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[288],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,f=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(f,s(s({ref:t},u),{},{components:n})):r.createElement(f,s({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8002:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return u},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),s=["components"],i={sidebar_position:5},c="Post Processing",l={unversionedId:"creating-charts/post-processing",id:"creating-charts/post-processing",title:"Post Processing",description:"Post Processing allows you to customize data before it is rendered as a chart, table or number. While the data source already provides powerful features to select, aggregate and group data, some use-cases may require more customization that isn't possible or is very complicated with database queries.",source:"@site/docs/creating-charts/post-processing.md",sourceDirName:"creating-charts",slug:"/creating-charts/post-processing",permalink:"/docs/creating-charts/post-processing",editUrl:"https://github.com/corescopic/docs/edit/main/website/docs/creating-charts/post-processing.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"CQL",permalink:"/docs/creating-charts/data-source/cql"}},u=[],p={toc:u};function d(e){var t=e.components,i=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"post-processing"},"Post Processing"),(0,o.kt)("p",null,"Post Processing allows you to customize data before it is rendered as a chart, table or number. While the data source already provides powerful features to select, aggregate and group data, some use-cases may require more customization that isn't possible or is very complicated with database queries."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"While post-processing allows powerful customization, the processing will happen in the browser. Due to this, all required data needs to be transmitted and execution may be comparatively slow.\nUsing the data source query instead of complicated post-processing scripts is recommended when possible.")),(0,o.kt)("p",null,"In the chart editor you may provide a post-processing script - by default this script will be:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JavaScript"},"((data) => {\n  return data;\n})\n")),(0,o.kt)("p",null,"corescopic uses JavaScript as the programming language for post-processing script."),(0,o.kt)("p",null,"The post-processing script is a function that takes one parameter - ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," - that contains the data fetched from the database."),(0,o.kt)("p",null,"The provided ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," array might look like this - but it highly depends on the data source query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JavaScript"},'[\n  {\n    "events.count": 2,\n    "events.user_id": "O2XfWSAl8mLYJ8fNikgf9bCIoENG9bJmj4FRfpo5Iq0HRWW4ajsT3lbExOGyVmfSongPiCX8abEpR9jXHpl7U8sx5S2hRZaWH8tH",\n    "events.session_id": "CcOKKdyeX6OzlVRmG0YnXtCIne0ulU7lmjJjbuWpivMt6EuY7FD87HcHPQM0Pkhhk8dK3XjsvFFoBvl1ptZ75wbiz6Kw63xZpy6b",\n    "events.contents.accountType": "new"\n  },\n  {\n    "events.count": 19,\n    "events.user_id": "0HRWW4ajsT3lbExOGyVmfSongPiCX8abEpR9jXHpl7U8sx5S2hRZaWH8tHO2XfWSAl8mLYJ8fNikgf9bCIoENG9bJmj4FRfpo5Iq",\n    "events.session_id": "ne0ulU7lmjJjbuWpivMt6EuY7FD87HcHPQM0Pkhhk8dK3XjsvFFoBvl1ptZ75wbiz6Kw63xZpy6bCcOKKdyeX6OzlVRmG0YnXtCI",\n    "events.contents.accountType": "existing"\n  }\n]\n')),(0,o.kt)("p",null,"Your function should return an array of data elements that will be used for charting."),(0,o.kt)("p",null,"A script must return the processed value directly (i.e. can't use methods like Promises or async) and will be terminated after 5 seconds as a script running this long will be marked as unresponsive."),(0,o.kt)("p",null,'For the example data provided above, you could transform the "accountType" to be a more readable "New Customer" and "Existing Customer" instead of "new" and "existing" using this script:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JavaScript"},'((data) => {\n  return data.map((item) => {\n    item[\'events.contents.accountType\'] = item[\'events.contents.accountType\'] === "new" ? "New Customer" : "Existing Customer";\n    return item;\n  });\n})\n')),(0,o.kt)("h1",{id:"sandbox"},"Sandbox"),(0,o.kt)("p",null,"The script will run in a sandboxed ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API"},"Web Worker"),". Due to the sandboxing, you may only access whitelisted functions like ",(0,o.kt)("inlineCode",{parentName:"p"},"parseInt")," but can't access functions like ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"While the sandbox provides some protection against malicious code, you should not run untrusted post-processing code in your user account.")),(0,o.kt)("p",null,"Whitelisted functions and features currently are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Array"),(0,o.kt)("li",{parentName:"ul"},"Boolean"),(0,o.kt)("li",{parentName:"ul"},"Date"),(0,o.kt)("li",{parentName:"ul"},"Function"),(0,o.kt)("li",{parentName:"ul"},"Object"),(0,o.kt)("li",{parentName:"ul"},"String"),(0,o.kt)("li",{parentName:"ul"},"undefined"),(0,o.kt)("li",{parentName:"ul"},"Infinity"),(0,o.kt)("li",{parentName:"ul"},"isFinite"),(0,o.kt)("li",{parentName:"ul"},"isNaN"),(0,o.kt)("li",{parentName:"ul"},"Math"),(0,o.kt)("li",{parentName:"ul"},"NaN"),(0,o.kt)("li",{parentName:"ul"},"Number"),(0,o.kt)("li",{parentName:"ul"},"parseFloat"),(0,o.kt)("li",{parentName:"ul"},"parseInt"),(0,o.kt)("li",{parentName:"ul"},"RegExp"),(0,o.kt)("li",{parentName:"ul"},"console")),(0,o.kt)("p",null,"You may use any of these features in your script. If you use any non-whitelisted features, the chart will show the data directly returned by the database and log information about the access violation into the console:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Sandbox violation in console",src:n(1271).Z})))}d.isMDXComponent=!0},1271:function(e,t,n){t.Z=n.p+"assets/images/sandbox_violation-2383dfa00bc1b6eb1794596f71dcabba.png"}}]);